# Usage 관리
Usage Server는 Mold에 대한 청구 통합을 생성하는 데 사용할 수 있는 집계 된 사용 현황 레코드를 제공하는 Mold의 선택 사항이며 별도로 설치되는 부분입니다. Usage Server는 이벤트 로그에서 데이터를 가져오고 listUsageRecords API 호출을 사용하여 액세스할 수 있는 요약 사용 현황 레코드를 작성하여 작동합니다. 버전 4.13 이상부터 listUsageRecords API 호출에 의해 반환 된 사용 현황 레코드 설명은 내부 데이터베이스 ID 대신 Mold 리소스 UUID를 사용합니다. 이전 형식으로 설명을 얻기 위해 기본적으로 false 인 API 매개 변수 "oldformat"이 도입되었습니다.

사용 현황 레코드는 게스트 가상머신에서 사용하는 VM 런타임 또는 템플릿 스토리지 공간과 같은 리소스의 양을 보여줍니다.

Usage Server는 하루에 한 번 이상 실행됩니다. 하루에 여러 번 실행되도록 구성할 수도 있습니다.

## Usage 서버 구성
Usage Server를 구성하려면 :

1. Usage Server가 설치되었는지 확인하십시오. 이를 위해서는 Mold 소프트웨어를 설치하는 것 이상의 추가 단계가 필요합니다. 고급 설치 안내서의 Usage Server 설치 (선택 사항)를 참조하십시오.
2. Mold UI에 관리자로 로그인하십시오.
3. 글로벌 설정을 클릭합니다.
4. 검색 기능을 통해 설정하려는 동작을 제어하는 구성 매개 변수를 찾으십시오. 사용 가능한 매개 변수에 대한 설명은 아래 표를 참조하십시오.
5. 작업에서 편집 아이콘을 클릭합니다.
6. 원하는 값을 입력하고 저장 아이콘을 클릭합니다.
7. 관리 서버 (전역 구성 변경 시와 같이)와 Usage Server를 다시 시작합니다.
    ````
    # service cloudstack-management restart
    # service cloudstack-usage restart
    ````
   
enable.usage.server

- Usage Server 활성 여부.

usage.aggregation.timezone

- 사용 현황 기록의 시간대. 사용 현황 기록과 일일 작업 실행이 다른 시간대에 있는 경우 이를 설정하십시오. 예를 들어 다음 설정을 사용하면 사용 현황 작업이 PST 00:15에 실행되고 00:00:00 GMT에서 23:59:59 GMT까지 24시간 동안 사용 현황 레코드를 생성합니다.

````
usage.stats.job.exec.time = 00:15
usage.execution.timezone = PST
usage.aggregation.timezone = GMT
````

usage.sanity.check.interval

- 온전성 검사 간격(일)입니다. 고객 청구서를 발행하기 전에 정기적으로 잘못된 데이터가 있는 레코드를 검색하려면 이 옵션을 설정합니다. 예를 들어 VM이 폐기된 후 생성된 VM 사용량 레코드를 확인하고 템플릿, 볼륨 등을 유사한 방식으로 확인합니다. 또한 집계 범위보다 긴 사용 시간을 확인합니다. 문제가 발견되면 ALERT_TYPE_USAGE_SANITY_RESULT = 21 알림이 전송됩니다.

usage.stats.job.aggregation.range

- Usage Server 처리 작업 사이의 시간 (분)입니다. 예를 들어 1440으로 설정하면 Usage Server가 하루에 한 번 실행됩니다. 600으로 설정하면 10 시간마다 실행됩니다. 일반적으로 Usage Server 작업이 실행되면 사용이 마지막으로 실행 된 이후 생성된 모든 이벤트를 처리합니다.

      1440의 경우 특별하게 취급됩니다.(하루 1 회)  이 경우 Usage Server는 Usage가 마지막으로 실행 된 이후 모든 레코드를 반드시 처리하지는 않습니다. Mold는 이전의 완전한 하루 기록에 대해 하루에 한 번 처리해야한다고 가정합니다. 예를 들어, 현재 날짜가 10 월 7 일이면 10 월 6 일 자정부터 자정까지의 레코드를 처리한다고 가정합니다. Mold는이 "자정부터 자정까지"가 usage.execution.timezone에 상대적이라고 가정합니다.

      기본값 : 1440

usage.stats.job.exec.time

- Usage Server 처리가 시작되는 시간입니다. 서버의 시간대에서 24 시간 형식 (HH : MM)으로 지정되며 GMT 여야합니다. 예를 들어 GMT 10:30에 사용 작업을 시작하려면 "10:30"을 입력합니다.

      usage.stats.job.aggregation.range도 설정되고 해당 값이 1440이 아닌 경우 해당 값이 usage.stats.job.exec.time에 추가되어 Usage Server 작업을 다시 실행할 시간을 얻습니다. 이 작업은 24 시간이 경과 할 때까지 반복되며 다음 날의 처리는 usage.stats.job.exec.time에 다시 시작됩니다.

      기본값 : 00:15.

예를 들어 서버가 GMT에 있고 사용자 인구가 주로 미국 동부 해안에 있으며 매일 밤 현지 시간 (EST) 오전 2시에 사용 레코드를 처리하려고한다고 가정합니다. 다음 설정을 선택하십시오.

- enable.usage.server = true
- usage.execution.timezone = America / New_York
- usage.stats.job.exec.time = 07:00. 이렇게 하면 동부 표준시 오전 2시에 사용 작업이 실행됩니다. 미국 동부 해안이 서머타임제에 들어가고 나올 때 한 시간 씩 이동합니다.
- usage.stats.job.aggregation.range = 1440

이 구성을 사용하면 사용량 작업이 매일 밤 오전 2시 (EST)에 실행되고 EST (America / New_York) 시간대에 정의 된대로 전날의 자정-자정에 대한 레코드를 처리합니다.

!!! Note
    usage.stats.job.aggregation.range에 특수 값 1440이 사용되었으므로 Usage Server는 자정에서 오전 2시 사이의 데이터를 무시합니다. 해당 데이터는 다음 날 실행에 포함됩니다.

## Usage 제한 설정
Mold는 사용자의 리소스 사용량을 제한하기 위한 여러 관리자 제어 지점을 제공합니다. 이러한 제한 중 일부는 전역 구성 매개 변수입니다. 다른 것들은 ROOT 도메인에 적용되며 계정별로 재정의 될 수 있습니다.

### 전역적으로 구성된 제한
Zone에서 게스트 가상 네트워크에는 기본적으로 24 비트 CIDR이 있습니다. 이렇게 하면 게스트 가상 네트워크가 실행 중인 가상머신 254 개로 제한됩니다. 필요에 따라 조정할 수 있지만 Zone에서 가상머신을 만들기 전에이 작업을 수행해야합니다. 예를 들어 10.1.1.0/22는 ~ 1000 개의 주소를 제공합니다.

다음 표에는 전역 구성에 설정된 제한이 나열되어 있습니다.

| 매개 변수 이름 | 정의 |
|:---|:---|
| max.account.public.ips | 계정이 소유 할 수 있는 Public IP 주소 수 |
| max.account.snapshots | 계정에 대해 존재할 수 있는 스냅샷 수 |
| max.account.templates | 계정에 대해 존재할 수 있는 템플릿 수 |
| max.account.user.vms | 계정에 대해 존재할 수 있는 가상 머신 가상머신 수 |
| max.account.volumes | 계정에 대해 존재할 수 있는 디스크 볼륨 수 |
| max.template.iso.size | 다운로드 한 템플릿 또는 ISO의 최대 크기 (GB) |
| max.volume.size.gb | 볼륨의 최대 크기 (GB) |
| network.throttling.rate | 사용자 당 허용되는 기본 데이터 전송 속도 (초당 메가 비트) (XenServer에서 지원됨) |
| snapshot.max.hourly | 볼륨에 대해 보존할 최대 반복 시간당 스냅샷입니다. 한도에 도달하면 새 스냅샷을 저장할 수 있도록 시작 시간의 초기 스냅샷이 삭제됩니다. 이 제한은 수동 스냅샷에는 적용되지 않습니다. 0으로 설정하면 반복되는 시간별 스냅샷을 예약할 수 없습니다. |
| snapshot.max.daily | 볼륨에 대해 보존할 최대 반복 일일 스냅샷입니다. 한도에 도달하면 새 스냅샷을 저장할 수 있도록 하루의 시작부터 스냅샷이 삭제됩니다. 이 제한은 수동 스냅샷에는 적용되지 않습니다. 0으로 설정하면 반복되는 일일 스냅샷을 예약할 수 없습니다. |
| snapshot.max.weekly | 볼륨에 대해 보존할 최대 반복 주간 스냅샷입니다. 한도에 도달하면 새 스냅샷을 저장할 수 있도록 한주의 시작부터 스냅샷이 삭제됩니다. 이 제한은 수동 스냅샷에는 적용되지 않습니다. 0으로 설정하면 반복되는 주간 스냅샷을 예약할 수 없습니다. |
| snapshot.max.monthly | 볼륨에 대해 보존할 최대 반복 월간 스냅샷입니다. 한도에 도달하면 새로운 스냅샷을 저장할 수 있도록 월초의 스냅샷이 삭제됩니다. 이 제한은 수동 스냅샷에는 적용되지 않습니다. 0으로 설정하면 매월 반복되는 스냅샷을 예약할 수 없습니다. |

글로벌 구성 매개 변수를 수정하려면 Mold UI의 글로벌 구성 화면을 사용하십시오. 전역 구성 매개 변수 설정을 참조하십시오.
### 리소스 사용 제한
Mold를 사용하면 CPU, RAM, 기본 스토리지 및 보조 스토리지와 같은 리소스 유형에 따라 리소스 사용량을 제어할 수 있습니다. 새로운 사용자 지정 모델 (대형 VM 또는 소형 VM과 같은 필요 기반 사용)을 지원하기 위해 새로운 리소스 유형 집합이 기존 리소스 풀에 추가되었습니다. 새로운 리소스 유형은 이제 CPU, RAM, 기본 스토리지 및 보조 스토리지로 광범위하게 분류됩니다. 루트 관리자는 도메인, 프로젝트 및 계정에 대해 다음 자원 유형에 따라 자원 사용 제한을 부과 할 수 있습니다.

- CPU
- 메모리 (RAM)
- 기본 스토리지 (볼륨)
- 보조 저장소 (스냅샷, 템플릿, ISO)

이 기능의 동작을 제어하기 위해 다음 구성 매개 변수가 추가되었습니다.

| 매개 변수 이름 | 기술 |
|:---|:---|
| max.account.cpus | 계정에 사용할 수 있는 최대 CPU 코어 수입니다. 기본값은 40입니다. |
| max.account.memory (MB) | 계정에 사용할 수 있는 최대 Memory입니다. 기본값은 40960입니다. |
| max.account.primary.storage (GB) | 계정에 사용할 수 있는 최대 기본 저장 공간입니다. 기본값은 200입니다. |
| max.account.secondary.storage (GB) | 계정에 사용할 수 있는 최대 보조 저장 공간입니다. 기본값은 400입니다. |
| max.project.cpus | 계정에 사용할 수 있는 최대 CPU 코어 수입니다. 기본값은 40입니다. |
| max.project.memory (MB) | 계정에 사용할 수 있는 최대 Memory입니다. 기본값은 40960입니다. |
| max.project.primary.storage (GB) | 계정에 사용할 수 있는 최대 기본 저장 공간입니다. 기본값은 200입니다. |
| max.project.secondary.storage (GB) | 계정에 사용할 수 있는 최대 보조 저장 공간입니다. 기본값은 400입니다. |

### 사용자 권한
루트 관리자, 도메인 관리자 및 사용자는 리소스를 나열할 수 있습니다. vmops.log 및 api.log 파일 에 적절한 로그가 유지되는지 확인하십시오 .

- 루트 관리자는 리소스 제한을 나열하고 업데이트 할 수 있는 권한이 있습니다.
- 도메인 관리자는 자신의 도메인 또는 하위 도메인에 속한 하위 도메인 및 계정에 대해서만 이러한 리소스 제한을 나열하고 변경할 수 있습니다.
- 최종 사용자는 리소스 제한을 나열할 수 있는 권한이 있습니다. listResourceLimits API를 사용하십시오.
### 사용 제한 시 고려 사항
- 기본 또는 보조 스토리지 공간은 물리적 크기 (씬 프로비저닝의 경우 디스크에서 실제로 사용되는 크기)가 아닌 명시된 볼륨 크기를 나타냅니다.

- 관리자가 계정에 대한 리소스 제한을 줄이고 현재 사용 중인 리소스보다 작게 설정하면 기존 VM / 템플릿 / 볼륨이 삭제되지 않습니다. 해당 계정의 사용자가 이러한 리소스를 사용하여 새 작업을 실행하려고하는 경우에만 제한이 적용됩니다. 예를 들어 VM의 경우 기존 동작은 다음과 같습니다.

    - migrateVirtualMachine : 해당 계정의 사용자는 제한 문제없이 실행 중인 VM을 다른 호스트로 마이그레이션할 수 있습니다.
    - recoverVirtualMachine : 삭제 된 VM은 복구 할 수 없습니다.
    
- 모든 리소스 유형에 대해 도메인에 제한 X가있는 경우 해당 도메인의 하위 도메인 또는 계정에 자체 제한이있을 수 있습니다. 그러나 어느 시점에서든 도메인 아래의 하위 도메인 또는 계정에 할당된 리소스의 합계는 값 X를 초과 할 수 없습니다. 
  
예를 들어 도메인의 CPU 제한이 40이고 하위 도메인 D1과 계정 A1은 각각 30 개의 제한을 가질 수 있지만 어느 시점에서든 D1 및 A1에 할당된 리소스는 제한 40을 초과하지 않아야합니다.

- 작업이 두 개 이상의 리소스 제한 검사를 통과해야하는 경우 2 개 중 더 낮은 제한이 적용됩니다. 예 : 계정의 VM 제한이 10이고 CPU 제한이 20이고 해당 계정의 사용자가 5를 요청하는 경우 각각 4 개의 CPU로 구성된 VM. VM 제한이 10 개이므로 사용자는 5 개의 VM을 더 배포할 수 있습니다.하지만 CPU 제한이 소진 되었기 때문에 사용자는 더 이상 가상머신을 배포할 수 없습니다.

### 도메인에서 리소스 사용 제한
Mold를 사용하면 도메인별로 제한을 구성할 수 있습니다. 도메인 제한이 설정되어 있어도 모든 사용자는 여전히 계정 제한이 있습니다. 도메인에 설정된 리소스 제한을 초과하지 않도록 그룹으로 추가로 제한됩니다. 도메인 제한은 해당 도메인의 모든 하위 도메인에있는 모든 계정뿐만 아니라 도메인에있는 모든 계정의 사용량을 집계합니다. 루트 도메인 수준에서 설정된 제한은 해당 루트 도메인 아래의 모든 도메인 및 하위 도메인에있는 계정의 리소스 사용량 합계에 적용됩니다.

도메인 제한을 설정하려면 :

1. Mold UI에 로그인합니다.

2. 왼쪽 메뉴 트리에서 도메인을 클릭합니다.

3. 수정할 도메인을 선택하십시오. 제한 구성 탭을 클릭하면 현재 도메인의 제한 구성이 표시됩니다.

    -1 값은 제한이 없음을 나타냅니다.

4. 요구 사항에 따라 다음을 편집하십시오.

    - 매개 변수 이름
    - 기술
    - 사용자 VM

        도메인에서 사용할 수 있는 가상머신 수입니다.
      
    - Public IP 제한
        
        도메인에서 사용할 수 있는 Public IP 주소의 수입니다.
    
    - 볼륨 제한
    
        도메인에서 만들 수 있는 디스크 볼륨의 수입니다.
    
    - 스냅샷 제한
    
        도메인에서 생성할 수 있는 스냅샷 수입니다.
    
    - 템플릿 제한
    
        도메인에 등록 할 수 있는 템플릿 수입니다.

   - 네트워크 제한 

     도메인에 등록 할 수 있는 네트워크 수입니다.
   
    - VPC 제한
    
        도메인에서 생성할 수 있는 VPC 수입니다.
    
    - CPU 코어 제한
    
        도메인에 사용할 수 있는 CPU 코어 수입니다.
    
    - 메모리 제한 (MiB)
    
        도메인에 사용할 수 있는 메모리 용량입니다.
    
    - 기본 저장소 한도 (GiB)
    
        도메인에 사용할 수 있는 기본 스토리지 공간입니다.
    
    - 보조 저장소 한도 (GiB)
    
        도메인에 사용할 수 있는 보조 저장 공간입니다.

5. 보내기를 클릭하십시오.

### 기본 계정 자원 제한
계정별로 자원 사용을 제한할 수 있습니다. 기본 제한은 글로벌 구성 매개 변수를 사용하여 설정되며 클라우드 내의 모든 계정에 영향을줍니다. 관련 매개 변수는 max.account로 시작하는 매개 변수입니다. (예 : max.account.snapshots)

특정 계정에 대한 기본 제한을 재정의하려면 계정 당 리소스 제한을 설정합니다.

1. Mold UI에 로그인합니다.
2. 왼쪽 메뉴 트리에서 계정을 클릭합니다.
3. 수정할 계정을 선택하십시오. 제한 구성 탭을 클릭하면 현재 도메인의 제한 구성이 표시됩니다.
   
    -1 값은 제한이 없음을 나타냅니다.
   
4. 요구 사항에 따라 다음을 편집하십시오.
    - 매개 변수 이름
    - 기술
    - VM 제한
      
        계정에서 사용할 수 있는 가상머신 수입니다.
      
        기본값은 20입니다.
      
    - Public IP 제한
      
        계정에서 사용할 수 있는 Public IP 주소의 수입니다.
    
        기본값은 20입니다.
      
    - 볼륨 제한
    
        계정에서 생성할 수 있는 디스크 볼륨의 수입니다.
    
        기본값은 20입니다.
      
    - 스냅샷 제한
      
        계정에서 생성할 수 있는 스냅샷 수입니다.
       
        기본값은 20입니다.
      
    - 템플릿 제한
    
        계정에 등록 할 수 있는 템플릿 수입니다.
    
        기본값은 20입니다.

    - 네트워크 제한
    
        계정에 등록 할 수 있는 네트워크 수입니다.
    
        기본값은 20입니다.
      
    - VPC 제한
    
        계정에서 생성할 수 있는 VPC 수입니다.
    
        기본값은 20입니다.
      
    - CPU 코어 제한
    
        계정에 사용할 수 있는 CPU 코어 수입니다.
       
        기본값은 40입니다.
      
    - 메모리 제한 (MiB)
    
        계정에 사용할 수 있는 메모리 용량입니다.
    
        기본값은 40960입니다.
      
    - 기본 스토리지 한도 (GiB)
    
        계정에 사용할 수 있는 기본 저장 공간입니다.
    
        기본값은 200입니다.
      
    - 보조 스토리 한도 (GiB)
       
        계정에 사용할 수 있는 보조 저장 공간입니다.
    
        기본값은 400입니다.

5. 보내기를 클릭하십시오.

## Usage 기록 형식
### 가상 머신 Usage 기록 형식
실행 및 할당된 가상 머신 사용량의 경우 사용량 레코드에 다음 필드가 있습니다.

- account – 계정 이름
- accountid – 계정의 ID
- domainid – 이 계정이있는 도메인의 ID
- zoneid – 사용 현황이 발생한 Zone
- description – 사용 현황 레코드가 추적하는 내용을 설명하는 문자열
- usage – 사용량 단위를 포함한 사용량의 문자열 표현 (예 : VM 실행 시간의 'Hrs')
- usagetype – 사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage – 실제 사용량을 시간 단위로 나타내는 숫자
- virtualMachineId – 가상 머신의 ID
- name – 가상 머신의 이름
- offerid – 서비스 오퍼링의 ID
- templateid – 템플릿의 ID 또는 상위 템플릿의 ID입니다. 상위 템플릿 값은 현재 템플릿이 볼륨에서 생성되었을 때 존재합니다.
- usageid – 가상 머신
- type – 하이퍼 바이저
- startdate, enddate – 사용량이 집계되는 시간 범위입니다. 사용 기록의 날짜 참조

### 네트워크 Usage 기록 형식
네트워크 사용량 (송 / 수신 바이트)의 경우 사용량 레코드에 다음 필드가 있습니다.

- account – 계정 이름
- accountid – 계정의 ID
- domainid –이 계정이있는 도메인의 ID
- zoneid – 사용현황이 발생한 Zone
- description – 사용 레코드가 추적하는 내용을 설명하는 문자열
- usagetype – 사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage – 실제 사용량을 시간 단위로 나타내는 숫자
- usageid – 장치 ID (가상 라우터 ID 또는 외부 장치 ID)
- type – 장치 유형 (도메인 라우터, 외부 로드 밸런서 등)
- startdate, enddate – 사용량이 집계되는 시간 범위입니다. 사용 기록의 날짜 참조

### IP 주소 Usage 기록 형식
IP 주소 사용의 경우 사용 레코드에 다음 필드가 있습니다.

- account - 계정 이름
- accountid - 계정의 ID
- domainid - 이 계정이있는 도메인의 ID
- zoneid - 사용현황이 발생한 Zone
- description - 사용 레코드가 추적하는 내용을 설명하는 문자열
- usage - 사용량 단위를 포함한 사용량의 문자열 표현
- usagetype - 사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage - 실제 사용량 (시간)을 나타내는 숫자
- usageid - IP 주소 ID
- startdate, enddate - 사용량이 집계되는 기간입니다. 사용 기록의 날짜 참조
- issourcenat - Source NAT가 IP 주소에 대해 활성화되었는지 여부
- iselastic - IP 주소가 탄력적이면 True입니다.

### 디스크 볼륨 Usage 레코드 형식
디스크 볼륨의 경우 사용 레코드에 다음 필드가 있습니다.

- account – 계정 이름
- accountid – 계정의 ID
- domainid –이 계정이있는 도메인의 ID
- zoneid – 사용현황이 발생한 Zone
- description – 사용 레코드가 추적하는 내용을 설명하는 문자열
- usage – 사용량 단위를 포함한 사용량의 문자열 표현 (예 : 시간의 경우 'Hrs')
- usagetype – 사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage – 실제 사용량을 시간 단위로 나타내는 숫자
- usageid – 볼륨 ID
- offerid – 디스크 오퍼링의 ID
- type – 하이퍼 바이저
- templateid – ROOT 템플릿 ID
- size – 할당된 스토리지 양
- startdate, enddate – 사용량이 집계되는 시간 범위입니다. 사용 기록의 날짜 참조

### 템플릿, ISO 및 스냅샷 Usage 기록 형식
- account – 계정 이름
- accountid – 계정의 ID
- domainid –이 계정이있는 도메인의 ID
- zoneid – 사용이 발생한 Zone
- description – 사용 레코드가 추적하는 내용을 설명하는 문자열
- usage – 사용량 단위를 포함한 사용량의 문자열 표현 (예 : 시간의 경우 'Hrs')
- usagetype – 사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage – 실제 사용량을 시간 단위로 나타내는 숫자
- usageid – 템플릿, ISO 또는 스냅샷의 ID
- offerid – 디스크 오퍼링의 ID
- templateid – 템플릿에만 포함됩니다 (사용 유형 7). 소스 템플릿 ID.
- size – 템플릿, ISO 또는 스냅샷의 크기
- startdate, enddate – 사용량이 집계되는 시간 범위입니다. 사용 기록의 날짜 참조

### 로드 밸런서 정책 또는 포트 포워딩 규칙 Usage 레코드 형식
- account-계정 이름
- accountid-계정의 ID
- domainid-이 계정이있는 도메인의 ID
- zoneid-사용이 발생한 Zone
- description-사용 레코드가 추적하는 내용을 설명하는 문자열
- usage-사용량 단위를 포함한 사용량의 문자열 표현 (예 : 시간의 경우 'Hrs')
- usagetype-사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage-실제 사용량 (시간)을 나타내는 숫자
- usageid-부하 분산기 정책 또는 포트 포워딩 규칙의 ID
- startdate, enddate-사용량이 집계되는 기간입니다. 사용 기록의 날짜 참조

### 네트워크 오퍼링 Usage 기록 형식
- account – 계정 이름
- accountid – 계정의 ID
- domainid –이 계정이있는 도메인의 ID
- zoneid – 사용이 발생한 Zone
- description – 사용 레코드가 추적하는 내용을 설명하는 문자열
- usage – 사용량 단위를 포함한 사용량의 문자열 표현 (예 : 시간의 경우 'Hrs')
- usagetype – 사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage – 실제 사용량을 시간 단위로 나타내는 숫자
- usageid – 네트워크 오퍼링의 ID
- offerid – 네트워크 오퍼링 ID
- virtualMachineId – 가상 머신의 ID
- startdate, enddate – 사용량이 집계되는 시간 범위입니다. 사용 기록의 날짜 참조

### VPN 사용자 Usage 기록 형식
- account – 계정 이름
- accountid – 계정의 ID
- domainid –이 계정이있는 도메인의 ID
- zoneid – 사용이 발생한 Zone
- description – 사용 레코드가 추적하는 내용을 설명하는 문자열
- usage – 사용량 단위를 포함한 사용량의 문자열 표현 (예 : 시간의 경우 'Hrs')
- usagetype – 사용 유형을 나타내는 숫자 (사용 유형 참조)
- rawusage – 실제 사용량을 시간 단위로 나타내는 숫자
- usageid – VPN 사용자 ID
- startdate, enddate – 사용량이 집계되는 시간 범위입니다. 사용 기록의 날짜 참조

## Usage 유형
다음 표는 모든 사용 유형을 보여줍니다.

| 유형 ID | 유형 이름 | 기술 |
|:---|:---|:---| 
| 1 | RUNNING_VM | 사용량 기록 기간 당 VM의 총 실행 시간을 추적합니다. 사용 기간 중에 VM을 업그레이드하면 새로 업그레이드 된 VM에 대해 별도의 사용 기록을 받게됩니다. |
| 2 | ALLOCATED_VM | VM이 생성된 총 시간을 폐기된 시간까지 추적합니다. 이 사용 유형은 Windows 기반 템플릿과 같은 특정 템플릿의 사용을 결정할 때도 유용합니다. |
| 3 | IP_ADDRESS | 계정이 소유 한 Public IP 주소를 추적합니다. |
| 4 | NETWORK_BYTES_SENT | 계정의 모든 VM에서 보낸 총 바이트 수를 추적합니다. Cloud.com은 현재 VM 당 네트워크 트래픽을 추적하지 않습니다. |
| 5 | NETWORK_BYTES_RECEIVED | 계정의 모든 VM에서받은 총 바이트 수를 추적합니다. Cloud.com은 현재 VM 당 네트워크 트래픽을 추적하지 않습니다. |
| 6 | VOLUME | 디스크 볼륨이 생성된 총 시간을 폐기된 시간까지 추적합니다. |
| 7 | TEMPLATE | 템플릿 (스냅샷에서 생성되거나 클라우드에 업로드 됨)이 생성된 총 시간을 폐기 시점까지 추적합니다. 템플릿의 크기도 반환됩니다. |
| 8 | ISO | ISO가 클라우드에서 제거 된 시간까지 업로드 된 총 시간을 추적합니다. ISO 크기도 반환됩니다. |
| 9 | SNAPSHOT | 스냅샷이 생성된 시점부터 삭제 된 시점까지의 총 시간을 추적합니다. |
| 10 | LOAD_BALANCER_POLICY | 로드 밸런서 정책이 생성된 총 시간을 제거 된 시간까지 추적합니다. Cloud.com은 VM이 정책에 할당되었는지 여부를 추적하지 않습니다. |
| 11 | PORT_FORWARDING_RULE | 포트 포워딩 규칙이 생성된 시점부터 제거 된 시점까지의 시간을 추적합니다. |
| 12 | NETWORK_OFFERING | 네트워크 오퍼링이 VM에 할당된 후 제거될 때까지의 시간입니다. |
| 13 | VPN_USERS | VPN 사용자가 생성된 후 제거될 때까지의 시간입니다.

## listUsageRecords의 응답 예
모든 Mold API 요청은 관련 명령 및 매개 변수와 함께 HTTP GET / POST 형식으로 제출됩니다. 요청은 HTTP 또는 HTTPS에 관계없이 다음으로 구성됩니다.
````xml
<listusagerecordsresponse>
   <count>1816</count>
   <usagerecord>
      <account>user5</account>
      <accountid>10004</accountid>
      <domainid>1</domainid>
      <zoneid>1</zoneid>
      <description>i-3-4-WC running time (ServiceOffering: 1) (Template: 3)</description>
      <usage>2.95288 Hrs</usage>
      <usagetype>1</usagetype>
      <rawusage>2.95288</rawusage>
      <virtualmachineid>4</virtualmachineid>
      <name>i-3-4-WC</name>
      <offeringid>1</offeringid>
      <templateid>3</templateid>
      <usageid>245554</usageid>
      <type>XenServer</type>
      <startdate>2009-09-15T00:00:00-0700</startdate>
      <enddate>2009-09-18T16:14:26-0700</enddate>
   </usagerecord>

   … (1,815 more usage records)
</listusagerecordsresponse>
````
## 사용 현황 기록 날짜
사용 현황 기록에는 시작 날짜와 종료 날짜가 포함됩니다. 이 날짜는 원시 사용량이 계산 된 기간을 정의합니다. 일별 집계를 사용하는 경우 시작 날짜는 해당 날짜의 자정이고 종료 날짜는 해당 날짜의 23:59:59입니다 (한 가지 예외가 있습니다. 아래 참조). 가상 머신은 당일 정오에 배포되고 당일 오후 6시에 중지 된 다음 오후 11시에 다시 시작될 수 있습니다. 그날 사용량을 계산하면 실행 중인 VM 사용량 (사용 유형 1) 7 시간과 할당된 VM 사용량 (사용 유형 2) 12 시간이됩니다. 동일한 가상 머신이 다음 날 전체 동안 실행되는 경우 실행 중인 VM 사용량 (유형 1)과 할당된 VM 사용량 (유형 2) 모두 24시간이됩니다.

참고 : 시작 날짜는 가상 머신이 시작된 시간이 아니며 종료 날짜는 가상 머신이 중지 된 시간이 아닙니다. 시작 및 종료 날짜는 사용량이 계산 된 시간 범위를 제공합니다.

네트워크 사용량의 경우 시작 날짜와 종료 날짜는 전송 된 바이트 수가 계산 된 범위를 다시 정의합니다. 사용자가 10MB를 다운로드하고 하루에 1MB를 업로드하면 수신 된 10MB를 표시하는 레코드와 전송 된 1MB를 표시하는 레코드가 있습니다.

매일 집계를 사용하는 경우 시작 날짜와 종료 날짜가 자정 및 오후 11:59:59와 일치하지 않는 경우가 있습니다. 이것은 네트워크 사용 기록에 대해서만 발생합니다. Usage Server에 처리되지 않은 데이터가 하루 이상있을 경우 이전 데이터가 집계 기간에 포함됩니다. 사용 기록의 시작 날짜는 가장 빠른 이벤트의 날짜와 시간을 표시합니다. IP 주소 및 VM과 같은 다른 사용 유형의 경우 처리되지 않은 이전 데이터는 일일 집계에 포함되지 않습니다.








