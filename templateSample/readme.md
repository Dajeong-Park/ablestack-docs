# 문서 작성 설명서

## 작성 규칙

- "아키텍처" -> "구성 정보" 순으로 작성합니다.




### 이미지 표시
이미지 위치를 center로 적용합니다.

<figure markdown>
!![이미지 제목](이미지 경로.png)
<figcaption>새 Affinity 그룹 추가 대화 상자</figcaption>
</figure markdown>


### Admonitions
추가 정보를 제공하거나 특이사항을 전달하기 위해 사용합니다.

- 사용 예:

!!! info "ABLESTACK Cube에서의 방화벽 설정"
    ABLESTACK Cube에서의 방화벽 설정을 위해 [Cube 방화벽 서비스 활성화](../../../../administration/cube/networking-guide#_27) 문서를 참고하십시오.

#### info
다른 문서를 참고하거나 다른 추가 설명이 필요한 경우 사용합니다.

#### warning
자원의 손실 또는 시스템 오류가 발생되어 서비스가 중단될 수 있는 잠재적인 위험에 대해 사용합니다.

#### danger
자원의 손실 또는 시스템 오류가 발생되어 서비스가 중단될 수 있는 즉각적인 위험에 대해 사용합니다.


### 코드 블록
타이틀을 작성하고 라인 표기 옵션을 적용합니다.

    ``` title="exports"  linenums="1"
    # 모든 사용자 접근 허용 시
    /mnt/data/nfs *(rw,sync,no_root_squash) 

    # 특정 범위 IP 사용자 접근 허용 시
    # /mnt/data/nfs 10.10.1.0/24(rw,sync,no_root_squash) 
    ```







## 유의 사항

- 타이틀을 생성할 경우, 그 타이틀에 대한 설명을 필수로 작성해야합니다.
- 목차 제목은 최대한 간단하게 합니다. 
- 서브 스텝은 되도록 쓰지 않도록 하고 만약 쓰게 된다면 서브 스텝에도 제목을 지정하여 작성합니다.
- 







본 문서에서는 ABLESTACK Mold를 이용해 "이중화를 통한 고가용성 기능을 제공하는 리눅스 기반의 3계층 구조"를 구성하는 방법에 대해 설명합니다. 
이를 위해 독립된 네트워크 공간인 VPC에 Subnet를 구성하고 WEB, WAS, DB 구성에 필요한 가상머신을 생성한 후 부하분산(LB)를 적용해아합니다.

## 아키텍처
다음 그림은 앞으로 구성할 리눅스 기반의 3계층 구조 전체를 보여줍니다.
아래 예시를 적용한 아키텍처 구성도를 참고하여 구성합니다.

<center>
![3tier-linux-01](../../../../assets/images/3tier-linux-architecture.png)
</center>

## 구성 정보
구성에 필요한 네트워크 및 가상머신 정보 예시는 다음과 같습니다.

### 네트워크 구성 정보
- VPC
    - CIDR: 192.168.0.0/16
- Subnet
    - DB
        - CIDR: 192.168.3.0/16
        - 게이트웨이: 192.168.3.1
    - WAS
        - CIDR: 192.168.2.0/16
        - 게이트웨이: 192.168.2.1
    - WEB
        - CIDR: 192.168.1.0/16
        - 게이트웨이: 192.168.1.1
- LB 
    - DB
        - Public IP: 10.10.1.80:3306
    - WAS
        - Public IP: 10.10.1.70:5000
    - WEB
        - Public IP: 10.10.1.60:6060
- 관리용 네트워크
    - Public IP: 10.10.1.90:3306

### 가상머신 구성 정보

|           | IP                | Offering                  |
| ----------| ------------------| --------------------------|
| DB        | 192.168.3.11 ~ 13 | 1Core 2GB, 100GB DataDisk |
| WAS       | 192.168.2.11 ~ 13 | 1Core 2GB, 100GB DataDisk |
| WEB       | 192.168.1.11 ~ 13 | 1Core 2GB, 100GB DataDisk |
| 관리용 가상머신 | 192.168.1.11 ~ 13 | 1Core 2GB, 100GB DataDisk |


## 구성 단계
"이중화를 통한 고가용성 기능을 제공하는 리눅스 기반의 3계층 구조"를 구성하는 단계는 다음과 같습니다.

- 네트워크 구성: VPC(Virtual Private Cloud)를 생성하고 서브넷(Subnet)을 생성합니다.
- 관리 가상머신 생성: WEB, WAS, DB을 구성하는 가상머신으로 SSH 접근하기 위한 관리용 가상머신을 생성합니다. 관리용 가상머신 생성 시, SSH Key 쌍을 생성하고 적용합니다.
- DB 구성: 가상머신 생성(어페니티+ssh키) + LB 갈레라 클러스터(Galera Cluster)를 활용하여 동기 방식의 복제구조를 사용하는 멀티마스터 DB를 구성합니다.
- WAS 구성: 도커 컨테이너를 이용하여 NodeJS와 Samba 스토리지를 활용한 WAS를 구성합니다.
- WEB 구성: 도커 컨테이너를 이용하여 Nginx와 NFS 스토리지를 활용한 WEB를 구성합니다.